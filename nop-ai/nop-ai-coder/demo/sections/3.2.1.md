# 3.2.1 基础数据管理

##  用户故事列表

###  US-3.2.1-001:物资分类管理(Priority:1,Efforts:0.5 PM)
- Who: 学校管理员
- What: 需要维护多级物资分类体系（如蔬菜类->叶菜类）
- Why: 确保物资能按科学分类体系进行管理
- 关联用例: UC-3.2.1-001,UC-3.2.1-002
- 关联页面: PG-3.2.1-001

###  US-3.2.1-002:物资信息维护(Priority:1,Efforts:1 PM)
- Who: 学校管理员
- What: 需要维护物资基础信息（名称/规格/单位等）和图片
- Why: 为出入库和库存管理提供基础数据
- 关联用例: UC-3.2.1-003,UC-3.2.1-004
- 关联页面: PG-3.2.1-002

###  US-3.2.1-003:供应商生命周期管理(Priority:2,Efforts:0.5 PM)
- Who: 学校管理员
- What: 需要管理供应商的启用/禁用状态
- Why: 确保只有合格供应商参与业务
- 关联用例: UC-3.2.1-005,UC-3.2.1-006
- 关联页面: PG-3.2.1-003

###  US-3.2.1-004:服务公司管理(Priority:1,Efforts:0.5 PM)
- Who: 学校管理员
- What: 需要维护服务公司基础信息
- Why: 作为系统权限分配的基础单位
- 关联用例: UC-3.2.1-007
- 关联页面: PG-3.2.1-004

###  US-3.2.1-005:基础菜单配方管理(Priority:3,Efforts:1 PM)
- Who: 营养师
- What: 需要维护标准菜单的配料组成及成本
- Why: 为成本核算和每日菜单提供基础
- 关联用例: UC-3.2.1-008,UC-3.2.1-009
- 关联页面: PG-3.2.1-005

##  用例列表

###  UC-3.2.1-001:维护物资分类(useCaseType:ui)

####  基本信息
- **菜单路径**：基础数据管理/物资管理/分类维护
- **参与者**：学校管理员
- **触发条件**：需要调整物资分类体系
- **使用频率**：低频

####  详细说明
**前置条件**：
1. 用户具有系统管理员权限

**基本流程**：
1. 展开现有分类树 [涉及UI：分类树组件]
2. 点击"新增子类"按钮 [涉及UI：操作工具栏]
3. 填写分类名称和编码
4. 提交保存 [涉及API：/api/material/category]
5. 刷新分类树显示

**异常流程**：
- 分支1：编码重复 → 提示"该分类编码已存在"
- 分支2：尝试删除非空分类 → 提示"请先移除子分类"

**后置条件**：
- 数据变更：material_category表记录更新

###  UC-3.2.1-002:导入物资分类(useCaseType:ui)

####  基本信息
- **菜单路径**：基础数据管理/物资管理/分类维护
- **参与者**：学校管理员
- **触发条件**：需要批量初始化分类数据
- **使用频率**：低频

####  详细说明
**前置条件**：
1. 已准备好Excel模板文件

**基本流程**：
1. 点击"批量导入"按钮
2. 上传Excel文件 [涉及UI：文件上传组件]
3. 系统校验数据格式
4. 执行批量导入 [涉及API：/api/material/category/import]
5. 显示导入结果报告

###  UC-3.2.1-003:新增物资(useCaseType:ui)

####  基本信息
- **菜单路径**：基础数据管理/物资管理/物资维护
- **参与者**：学校管理员
- **触发条件**：需要新增物资档案
- **使用频率**：中频

####  详细说明
**前置条件**：
1. 至少存在一个有效的物资分类

**基本流程**：
1. 标准CRUD流程（包含图片上传功能）
2. [涉及API：/api/material]
3. [涉及UI：PG-3.2.1-002]

###  UC-3.2.1-004:物资批量导入(useCaseType:ui)

####  基本信息
- **菜单路径**：基础数据管理/物资管理/物资维护
- **参与者**：学校管理员
- **触发条件**：学期初需要批量初始化物资数据
- **使用频率**：低频

####  详细说明
**前置条件**：
1. 已下载最新导入模板

**基本流程**：
1. 下载导入模板 [涉及API：/api/material/template]
2. 填写物资数据（含图片URL）
3. 执行批量导入 [涉及API：/api/material/import]
4. 显示导入结果

###  UC-3.2.1-005:维护供应商信息(useCaseType:ui)

####  基本信息
- **菜单路径**：基础数据管理/供应商管理
- **参与者**：学校管理员
- **触发条件**：需要更新供应商档案
- **使用频率**：中频

####  详细说明
**前置条件**：无

**基本流程**：
1. 标准CRUD流程
2. [涉及API：/api/supplier]
3. [涉及UI：PG-3.2.1-003]

###  UC-3.2.1-006:禁用供应商(useCaseType:ui)

####  基本信息
- **菜单路径**：基础数据管理/供应商管理
- **参与者**：学校管理员
- **触发条件**：供应商考核不合格
- **使用频率**：低频

####  详细说明
**前置条件**：
1. 目标供应商存在且状态为启用

**基本流程**：
1. 在列表页勾选供应商
2. 点击"禁用"按钮 [涉及UI：批量操作栏]
3. 填写禁用原因
4. 确认操作 [涉及API：/api/supplier/disable]
5. 列表自动刷新

###  UC-3.2.1-007:维护服务公司(useCaseType:ui)

####  基本信息
- **菜单路径**：基础数据管理/服务公司管理
- **参与者**：学校管理员
- **触发条件**：需要更新服务公司信息
- **使用频率**：低频

####  详细说明
**前置条件**：无

**基本流程**：
1. 标准CRUD流程
2. [涉及API：/api/service-company]
3. [涉及UI：PG-3.2.1-004]

###  UC-3.2.1-008:创建基础菜单(useCaseType:ui)

####  基本信息
- **菜单路径**：基础数据管理/菜单管理
- **参与者**：营养师
- **触发条件**：需要新增标准菜单
- **使用频率**：中频

####  详细说明
**前置条件**：
1. 相关物资已维护到系统中

**基本流程**：
1. 填写菜单基本信息（名称/类型/图片）
2. 添加配料项（物资选择带库存提示）
3. 计算预估成本 [涉及API：/api/material/price]
4. 保存菜单 [涉及API：/api/base-menu]
5. [涉及UI：PG-3.2.1-005]

###  UC-3.2.1-009:复制基础菜单(useCaseType:ui)

####  基本信息
- **菜单路径**：基础数据管理/菜单管理
- **参与者**：营养师
- **触发条件**：需要基于现有菜单创建相似菜单
- **使用频率**：中频

####  详细说明
**前置条件**：
1. 存在至少一个基础菜单

**基本流程**：
1. 在列表页点击"复制"按钮
2. 修改菜单名称
3. 调整配料组成
4. 保存为新菜单 [涉及API：/api/base-menu/copy]

##  页面列表

###  PG-3.2.1-001:物资分类管理(pageType:tabs)
**基本信息**：
- 菜单ID：material_category
- 设备适配：PC

**功能模块**：
| 区域 | 组件 | 行为 | 关联用例 |
|------|------|------|----------|
| 左侧 | 树形组件 | 支持拖拽排序 | UC-3.2.1-001 |
| 右侧 | 表单 | 显示当前节点详情 | UC-3.2.1-001 |
| 顶部 | 操作栏 | 含导入/导出按钮 | UC-3.2.1-002 |

###  PG-3.2.1-002:物资维护(pageType:list)
**基本信息**：
- 菜单ID：material
- 设备适配：响应式

**功能模块**：
| 区域 | 组件 | 行为 | 关联用例 |
|------|------|------|----------|
| 筛选区 | 分类选择器 | 联动表格数据 | UC-3.2.1-003 |
| 表格 | 图片缩略列 | 点击查看大图 | UC-3.2.1-003 |
| 工具栏 | 批量导入按钮 | 触发导入向导 | UC-3.2.1-004 |

###  PG-3.2.1-003:供应商管理(pageType:list)
**基本信息**：
- 菜单ID：supplier
- 模板参考：Ant Design ProTable
- 设备适配：PC

**功能模块**：
| 区域 | 组件 | 行为 | 关联用例 |
|------|------|------|----------|
| 状态筛选 | 单选按钮组 | 过滤列表数据 | UC-3.2.1-005 |
| 操作列 | 禁用按钮 | 显示状态相关操作 | UC-3.2.1-006 |

###  PG-3.2.1-004:服务公司管理(pageType:detail)
**基本信息**：
- 菜单ID：service_company
- 设备适配：PC

**功能模块**：
| 区域 | 组件 | 行为 | 关联用例 |
|------|------|------|----------|
| 基本信息 | 表单 | 显示统一社会信用代码等 | UC-3.2.1-007 |
| 状态控制 | 开关组件 | 控制公司可用状态 | UC-3.2.1-007 |

###  PG-3.2.1-005:基础菜单编辑(pageType:wizard)
**基本信息**：
- 菜单ID：base_menu_edit
- 设备适配：PC

**功能模块**：
| 区域 | 组件 | 行为 | 关联用例 |
|------|------|------|----------|
| 步骤条 | 向导导航 | 基本信息→配料→完成 | UC-3.2.1-008 |
| 配料表 | 动态表格 | 支持批量添加物资 | UC-3.2.1-008 |
| 成本汇总 | 统计卡片 | 实时计算总成本 | UC-3.2.1-008 |

##  业务规则
**数据规则**：
- material.code：必须唯一且符合^[A-Z]{2}\d{4}$格式
- supplier.credit_code：必须符合统一社会信用代码规则
- base_menu.ingredients：至少包含1项配料

**状态机规则**：
| 当前状态 | 允许操作 | 目标状态 | 条件 |
|----------|----------|----------|------|
| 启用 | 禁用 | 禁用 | 无 |
| 禁用 | 启用 | 启用 | 需审核 |

**计算规则**：
- 菜单成本 = Σ(配料数量 × 最近入库单价)

##  非功能需求

###  性能需求：
- 物资分类树加载时间 < 1s（2000节点规模）
- 批量导入支持500条/次的记录量

###  数据需求：
- 禁用数据保留周期：永久
- 图片存储：阿里云OSS

###  安全需求：
- 敏感字段：supplier.contact（加密存储）
- 审计要求：所有状态变更操作

##  待确认的问题
1. 物资分类是否需要支持校区维度的差异？
2. 供应商资质文件上传功能是否在本期实现？
3. 菜单图片是否限制最大尺寸？

