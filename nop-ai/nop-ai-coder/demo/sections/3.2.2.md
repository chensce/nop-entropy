# 3.2.2 经营管理

##  用户故事列表

###  US-3.2.2-001: 库房管理(Priority:3,Efforts:1 PM)
- Who: 库管员
- What: 需要管理多个库房的基础信息
- Why: 确保物资存储位置清晰可追溯
- 关联用例: UC-3.2.2-001,UC-3.2.2-002
- 关联页面: PG-3.2.2-001

###  US-3.2.2-002: 每日菜单管理(Priority:2,Efforts:2 PM)
- Who: 食堂管理员
- What: 需要根据基础菜单生成每日菜单
- Why: 确保每日供餐计划准确执行
- 关联用例: UC-3.2.2-003,UC-3.2.2-004
- 关联页面: PG-3.2.2-002

###  US-3.2.2-003: 出入库管理(Priority:1,Efforts:3 PM)
- Who: 库管员
- What: 需要记录物资的出入库操作
- Why: 确保物资流转可追溯
- 关联用例: UC-3.2.2-005,UC-3.2.2-006,UC-3.2.2-007
- 关联页面: PG-3.2.2-003,PG-3.2.2-004

###  US-3.2.2-004: 盘库管理(Priority:3,Efforts:2 PM)
- Who: 库管员
- What: 需要定期盘点库存
- Why: 确保账实相符
- 关联用例: UC-3.2.2-008
- 关联页面: PG-3.2.2-005

###  US-3.2.2-005: 供应商结算(Priority:2,Efforts:2 PM)
- Who: 财务人员
- What: 需要与供应商进行结算
- Why: 确保采购款项准确支付
- 关联用例: UC-3.2.2-009
- 关联页面: PG-3.2.2-006

###  US-3.2.2-006: 经营数据管理(Priority:4,Efforts:1 PM)
- Who: 经营管理人员
- What: 需要查看经营数据分析
- Why: 辅助经营决策
- 关联用例: UC-3.2.2-010
- 关联页面: PG-3.2.2-007

##  用例列表

###  UC-3.2.2-001: 库房信息维护(useCaseType:ui)

####  基本信息
- **菜单路径**：经营管理/库房管理
- **参与者**：库管员 + 系统管理员
- **触发条件**：新增/修改库房信息
- **使用频率**：低频

####  详细说明
**前置条件**：
1. 用户具有库管员权限
2. 服务公司信息已维护

**基本流程**：
1. 标准CRUD操作 [涉及UI：库房表单]
2. 成功结束条件：库房信息保存成功

**后置条件**：
- 数据变更：warehouse表记录变更

###  UC-3.2.2-002: 库房查询(useCaseType:ui)

####  基本信息
- **菜单路径**：经营管理/库房管理
- **参与者**：库管员
- **触发条件**：查看库房信息
- **使用频率**：中频

####  详细说明
**前置条件**：
1. 用户具有库管员权限

**基本流程**：
1. 标准查询操作 [涉及UI：库房列表]
2. 成功结束条件：显示查询结果

###  UC-3.2.2-003: 每日菜单生成(useCaseType:ui)

####  基本信息
- **菜单路径**：经营管理/每日菜单
- **参与者**：食堂管理员
- **触发条件**：制定每日供餐计划
- **使用频率**：高频

####  详细说明
**前置条件**：
1. 基础菜单已维护
2. 当前日期未生成菜单

**基本流程**：
1. 选择日期和基础菜单 [涉及UI：菜单选择器]
2. 自动计算预估成本 [涉及API：成本计算服务]
3. 确认保存 [涉及UI：保存按钮]
4. 成功结束条件：生成daily_menu记录

**异常流程**：
- 分支1：日期已存在菜单 → 提示覆盖确认
- 分支2：配料库存不足 → 显示预警提示

**后置条件**：
- 数据变更：daily_menu表新增记录

###  UC-3.2.2-004: 每日菜单查询(useCaseType:ui)

####  基本信息
- **菜单路径**：经营管理/每日菜单
- **参与者**：食堂管理员
- **触发条件**：查看历史菜单
- **使用频率**：中频

####  详细说明
**前置条件**：
1. 用户具有食堂管理员权限

**基本流程**：
1. 标准查询操作 [涉及UI：日期选择器]
2. 成功结束条件：显示查询结果

###  UC-3.2.2-005: 入库操作(useCaseType:ui)

####  基本信息
- **菜单路径**：经营管理/出入库管理/入库
- **参与者**：库管员
- **触发条件**：采购物资到货
- **使用频率**：高频

####  详细说明
**前置条件**：
1. 供应商信息已维护
2. 库房信息已维护

**基本流程**：
1. 选择供应商和库房 [涉及UI：下拉选择器]
2. 添加物资明细 [涉及UI：物资选择器]
3. 自动计算总金额 [涉及API：金额计算服务]
4. 上传附件 [涉及UI：文件上传组件]
5. 提交保存 [涉及UI：提交按钮]
6. 成功结束条件：生成stock_in_out和stock_detail记录，更新inventory表

**异常流程**：
- 分支1：物资编码无效 → 提示重新选择
- 分支2：必填字段缺失 → 高亮提示

**后置条件**：
- 数据变更：stock_in_out, stock_detail, inventory表记录变更

###  UC-3.2.2-006: 出库操作(useCaseType:ui)

####  基本信息
- **菜单路径**：经营管理/出入库管理/出库
- **参与者**：库管员
- **触发条件**：物资领用或消耗
- **使用频率**：高频

####  详细说明
**前置条件**：
1. 库房信息已维护
2. 库存数据存在

**基本流程**：
1. 选择源入库单或直接选物资 [涉及UI：入库单选择器]
2. 校验库存数量 [涉及API：库存校验服务]
3. 提交出库 [涉及UI：提交按钮]
4. 成功结束条件：生成出库记录，更新inventory表

**后置条件**：
- 数据变更：stock_in_out, stock_detail, inventory表记录变更

###  UC-3.2.2-007: 出入库记录查询(useCaseType:ui)

####  基本信息
- **菜单路径**：经营管理/出入库管理
- **参与者**：库管员
- **触发条件**：查看历史记录
- **使用频率**：中频

####  详细说明
**前置条件**：
1. 用户具有库管员权限

**基本流程**：
1. 标准组合查询操作 [涉及UI：高级查询表单]
2. 成功结束条件：显示查询结果

###  UC-3.2.2-008: 库存盘点(useCaseType:ui)

####  基本信息
- **菜单路径**：经营管理/盘库管理
- **参与者**：库管员
- **触发条件**：定期盘点或临时抽查
- **使用频率**：低频

####  详细说明
**前置条件**：
1. 库房信息已维护
2. 库存数据存在

**基本流程**：
1. 选择库房和盘点日期 [涉及UI：库房选择器]
2. 录入实际盘点数量 [涉及UI：盘点表格]
3. 生成盘盈盘亏报告 [涉及API：报告生成服务]
4. 成功结束条件：生成盘点差异记录

**后置条件**：
- 数据变更：inventory表记录调整

###  UC-3.2.2-009: 供应商结算(useCaseType:ui)

####  基本信息
- **菜单路径**：经营管理/供应商结算
- **参与者**：财务人员
- **触发条件**：到达结算周期
- **使用频率**：中频

####  详细说明
**前置条件**：
1. 存在未结算的入库单
2. 供应商信息有效

**基本流程**：
1. 选择供应商和结算周期 [涉及UI：结算周期选择器]
2. 生成结算单 [涉及API：结算单生成服务]
3. 确认支付 [涉及UI：支付确认对话框]
4. 成功结束条件：更新stock_in_out的paid_amount字段

**后置条件**：
- 数据变更：stock_in_out表paid_amount字段更新

###  UC-3.2.2-010: 经营数据分析(useCaseType:ui)

####  基本信息
- **菜单路径**：经营管理/经营数据
- **参与者**：经营管理人员
- **触发条件**：查看经营报表
- **使用频率**：低频

####  详细说明
**前置条件**：
1. 存在历史经营数据

**基本流程**：
1. 选择分析时段 [涉及UI：日期范围选择器]
2. 生成多维分析图表 [涉及API：数据分析服务]
3. 成功结束条件：显示可视化报表

##  页面列表

###  PG-3.2.2-001: 库房管理页面(pageType:list)
**基本信息**：
- 菜单ID：warehouse_management
- 设备适配：PC

**功能模块**：
| 区域 | 组件 | 行为 | 关联用例 |
|------|------|------|----------|
| 头部 | 搜索框 | 按名称/编码搜索 | UC-3.2.2-002 |
| 主体 | 数据表格 | 显示库房列表 | UC-3.2.2-001 |
| 底部 | 分页器 | 分页导航 | UC-3.2.2-002 |

###  PG-3.2.2-002: 每日菜单页面(pageType:tabs)
**基本信息**：
- 菜单ID：daily_menu
- 设备适配：响应式

**功能模块**：
| 区域 | 组件 | 行为 | 关联用例 |
|------|------|------|----------|
| 标签页 | 今日菜单 | 显示当日菜单 | UC-3.2.2-004 |
| 标签页 | 历史菜单 | 按日期查询 | UC-3.2.2-004 |
| 浮动按钮 | 新增按钮 | 打开生成表单 | UC-3.2.2-003 |

###  PG-3.2.2-003: 入库单页面(pageType:wizard)
**基本信息**：
- 菜单ID：stock_in
- 设备适配：PC

**功能模块**：
| 区域 | 组件 | 行为 | 关联用例 |
|------|------|------|----------|
| 步骤1 | 基本信息表单 | 选择供应商/库房 | UC-3.2.2-005 |
| 步骤2 | 物资选择表格 | 添加物资明细 | UC-3.2.2-005 |
| 步骤3 | 附件上传区 | 上传凭证 | UC-3.2.2-005 |

###  PG-3.2.2-004: 出库单页面(pageType:detail)
**基本信息**：
- 菜单ID：stock_out
- 设备适配：PC

**功能模块**：
| 区域 | 组件 | 行为 | 关联用例 |
|------|------|------|----------|
| 头部 | 源单选择器 | 关联入库单 | UC-3.2.2-006 |
| 主体 | 物资表格 | 显示出库物资 | UC-3.2.2-006 |
| 底部 | 库存提示 | 显示实时库存 | UC-3.2.2-006 |

###  PG-3.2.2-005: 盘点页面(pageType:report)
**基本信息**：
- 菜单ID：inventory_check
- 设备适配：PC

**功能模块**：
| 区域 | 组件 | 行为 | 关联用例 |
|------|------|------|----------|
| 头部 | 库房选择器 | 选择盘点范围 | UC-3.2.2-008 |
| 主体 | 盘点表格 | 录入实际数量 | UC-3.2.2-008 |
| 底部 | 差异报告 | 显示盘盈盘亏 | UC-3.2.2-008 |

###  PG-3.2.2-006: 结算单页面(pageType:detail)
**基本信息**：
- 菜单ID：supplier_settlement
- 设备适配：PC

**功能模块**：
| 区域 | 组件 | 行为 | 关联用例 |
|------|------|------|----------|
| 头部 | 结算周期选择 | 设置起止日期 | UC-3.2.2-009 |
| 主体 | 结算明细表格 | 显示待结算单据 | UC-3.2.2-009 |
| 底部 | 支付操作区 | 确认支付 | UC-3.2.2-009 |

###  PG-3.2.2-007: 经营数据看板(pageType:report)
**基本信息**：
- 菜单ID：business_analytics
- 模板参考：类似阿里云QuickBI
- 设备适配：大屏

**功能模块**：
| 区域 | 组件 | 行为 | 关联用例 |
|------|------|------|----------|
| 筛选区 | 时间维度选择 | 切换分析时段 | UC-3.2.2-010 |
| 主体 | 数据可视化图表 | 显示趋势分析 | UC-3.2.2-010 |

##  业务规则
**数据规则**：
- 物资编码：必须符合^[A-Z]{2}\d{6}$格式
- 供应商状态：禁用状态不显示在选择列表中
- 每日菜单日期：不允许重复创建

**状态机规则**：

| 当前状态 | 允许操作 | 目标状态 | 条件 |
|----------|----------|----------|------|
| 未锁定 | 锁定 | 已锁定 | 具有锁定权限 |
| 已锁定 | - | - | 不可编辑 |

**计算规则**：
- 出库成本：采用移动加权平均法计算
- 菜单预估成本：∑(配料数量×最新入库单价)

##  非功能需求

###  性能需求：
- 并发用户：支持50个并发操作
- 吞吐量：20 TPS

###  数据需求：
- 保留周期：出入库记录保留5年
- 归档策略：每年1月归档上年度数据

###  安全需求：
- 敏感字段：供应商银行账号加密存储
- 审计要求：所有出入库操作记录审计日志

##  待确认的问题
1. 是否需要支持多币种结算？
2. 盘库差异的自动调账流程是否需要审批？
3. 经营数据看板是否需要支持导出PDF？

